\ifx\all\undefined
\include{base}
\begin{document}
\fi
 
\chapter{Evaluación}

Este capítulo expone las pruebas realizadas sobre el sistema desarrollado y evalúa su comportamiento frente a los casos de uso planteados. El objetivo es estudiar cómo mejora el formato extendido sobre el estándar ISDB-Tb tradicional. Asimismo, se exponen las limitaciones del nuevo diseño.

\section{Infraestructura}

La \cref{fig:infra_extended} expone la infraestructura involucrada en la emisión de servicios a través de radiofrecuencia y una red IP. 

\begin{figure}[h]
	\begin{center}
	\includegraphics[width=15cm]{imgs/infraestructura_extendida.png}
	\caption{Infraestructura utilizada en la emisión de servicios con el esquema extendido.\label{fig:infra_extended}} 
	\end{center}
\end{figure}

A diferencia de la norma ISDB-Tb tradicional, el nuevo esquema necesita un nuevo aparato para soportar el \emph{streaming} de contenidos a través de una red IP. En particular, es interesante notar la aparición de una entidad que no está relacionada con ninguna de las dos transmisiones, el \emph{coordinador}.

El coordinador decide qué servicios se emiten en la norma ISDB-Tb trandicional y cuáles por la red IP y define qué grupo multicast y puerto se usan para la emisión. Con esta información se completa del \emph{services elementaries relocation descriptor} y se configura al servidor de \emph{streaming} multicast.

Para las pruebas realizadas cuyos resultados se exponen en este capítulo se utilizó un esquema representado en la \cref{fig:test_scheme}.

\begin{figure}[h]
	\begin{center}
	\includegraphics[width=10cm]{imgs/infraestructura_prueba.png}
	\caption{Esquema de las pruebas\label{fig:test_scheme}} 
	\end{center}
\end{figure}

Las entidades que pueden observarse son:

\begin{itemize}
	\item \textbf{Host Multiplexador:} Controla la moduladora y provee el \emph{transport stream} extendido que se emite a través de la señal modulada. En este punto se introducen los elementos necesarios para señalizar los servicios que se obtienen a través de la red IP, identificada por la dirección IP asignada por el coordinador.
	\item \textbf{Moduladora}: Convierte el \emph{transport stream} en una señal radioeléctrica modulada.
	\item \textbf{\emph{Splitter:}} Mezcla la señal modulada que transporta el \emph{transport stream} generado y una señal regular de Televisión Digital Abierta. El objetivo de esta combinación es estudiar la convivencia del flujo de tranporte generado con otros tradicionales.
	\item \textbf{Sintonizador:} El sintonizador es la contrapartida de la moduadora, convierte una señal modulada en un \emph{bitstream} intepretable por \emph{Mara}.
	\item \textbf{Host de Mara:} Computadora que corre el reproductor de televisión y entrega los servicios al usuario, consumiendo de una u otra fuente de manera transparente.
	\item \textbf{Red IP:} Red con soporte de la \emph{suite} de protocolos IP, incluyendo emisión multicast.
	\item \textbf{Host de \emph{streaming}:} Emite el flujo de transporte que incluye el servicio realocado a través del grupo indicado por el coordinador..
\end{itemize}

[Acá algo tendría que aparecer, nomás. No se si primero habría que mostrar cómo se hicieron las pruebas y luego cómo se haría en un caso real o como está ahora mismo.]

\section{Número de servicios}

El objetivo final del nuevo diseño es extender la lista de servicios provistos por una señal ISDB-Tb convencional, a través del aprovechamiento de redes IP disponibles para el decodificador.

En un flujo de transporte de una señal ISDB-Tb tradicional, la única limitación considerable para el número de servicios provistos viene dada por el ancho de banda disponible para transmitir los contenidos multimedia. En el caso del formato extendido, los servicios que se envían por IP no ocupan ancho de banda(en términos de contenido multimedia) y el mismo requerido por la información de señalización es despreciable.

Por otro lado, el formato MPEG impone restricciones sobre los flujos de transporte que se ven reflejadas en el nuevo diseño. Existen numerosas limitaciones de índole sintáctica(como es el tamaño de un campo que indica la longitud de una entidad) y de garantías para el receptor(como es el grado de precisión que deben poseer las marcas de tiempo). En particular, hay dos ejemplos de restricción que afectan directamente al nuevo diseño y establecen una cota superior para el número de servicios a transmitir. Estos son el límite de tamaño de sección y la imposición sobre la frecuencia de emisión de las tablas.

Por simplicidad es posible dividir las limitaciones por tablas. La \cref{fig:max_serv_num} muestra la limitación que impone cada tabla al número de servicios de un flujo de transporte. Por un lado, la barra roja indica cuántos servicios puede señalizar una tabla si ésta ocupa una sección completa y, por el otro, la barra azul indica cuántos servicios se pueden señalizar con un único paquete de flujo de transporte.

% TODO: La SDT puede dividirse en múltiples secciones. Así que hay que modificar esto y el dibujito para contemplarlo.

\begin{figure}[h]
	\begin{center}
	\includegraphics[width=10cm]{imgs/maximo_num_servicios.png}
	\caption{Cantidad máxima de servicios permitida por cada tabla.\label{fig:max_serv_num}} 
	\end{center}
\end{figure}

% TODO: Quizás un reordenamiento es lo ideal acá. Porque no se entiende bien que el cuello de botella se presente al medio.

\subsection{Tamaño de sección}

% Averiguar qué concha es el tamaño de sección. Porque si distintos pedazos de la tabla se pueden enviar en distintas secciones, estamos hasta la chota.
% A partir de ahí la SDT tiene que compartir ancho de banda con la PMT. Podría intentar construir un ts con una SDT de muchas secciones.
% Si ese es el caso, seríá útil hacer una escala de "para x servicios, y ancho de banda necesario"

Las tablas viajan en estructuras sintácticas denominadas \emph{secciones}. El encabezado de una sección contiene su longitud en bytes en un campo de \emph{12 bits}. Esto es, este campo limita la longitud a 4096 bytes. Pero el estándar ISDB-Tb, a su vez, define que sólo la sección que transporta una EIT puede alcanzar este tamaño. El resto de las secciones deben limitarse a \emph{1 kilobyte}. En consecuencia, las tablas involucradas en la señalización de servicios transportados por IP están acotadas a este tamaño. 

A continuación se analiza cómo influye esta cota sobre el número total de servicios. Todas las mediciones se realizaron construyendo flujos de transporte reales, donde las tablas y secciones fueron creadas y multiplexadas utilizando el conjunto de herramientas provisto por OpenCaster y \emph{ts\_util}\cite{tsutil}.

\subsubsection{PAT}

Al momento de extender la lista de servicios de un flujo de transporte, el número de PAT's que viajan se conserva igual. Existe una PAT por flujo de tranporte. Sin embargo, el tamaño de la sección que transporta la PAT impone, como muestra la \cref{fig:max_serv_num}, un máximo de 252 servicios, en promedio. Este valor podría disminuir ante la inclusión de descriptores o datos adicionales, pero este no es un caso común. Si además se deseara limitar el tamaño de la PAT a un único paquete, la cota se reduce a 41 servicios.

El motivo para utilizar una PAT de un único paquete radica en la drástica simplificación de la multiplexación y decodificación del flujo de transporte. Adicionalmente, implica un pequeño ahorro en el ancho de banda (que podría ser utilizado, por ejemplo, para agregar nuevas PMT's, aunque esto no implique una diferencia sustancial).

\subsubsection{SDT}

La SDT transporta contenido textual descriptivo de los servicios y ésto le confiere dependencia respecto de los servicios provistos por el flujo de transporte. Para realizar la medición del número máximo de servicios que permite esta tabla, se utilizaron nombres de una longitud promedio de 9 caracteres. Como puede apreciarse en la \cref{fig:max_serv_num}, una sección establece una cota superior de 50 servicios, mientras que una SDT de un único paquete puede describir hasta 8 servicios. Esto convierte a las SDT en una limitación real para el número se servicios señalizables por la extensión del estándar ISDB-Tb.

\subsection{Disponibilidad de paquetes nulos}

% Decir que son dos imposiciones diferentes la que hace que la PMT limite el numero de servicios y la que hace que la SDT lo haga.

Finalmente, resta analizar cómo influye la PMT sobre el número máximo de servicios que se pueden señalizar. A diferencia de las otras dos, la PMT no cambia en tamaño en la medida en que se agregan servicios, dado que aparecen nuevas instancias en lugar de modificar las existentes. El problema es que cada PMT requiere un PID distinto y cada PID requiere de un paquete de flujo de transporte distinto.

Cada uno de los servicios de un flujo de transporte requiere la emisión de una PMT asociada, así sea un servicio regular o uno cuyos flujos elementales se transmiten por IP. El estándar ISDB-Tb establece que el intervalo máximo de tiempo entre instancias de la tabla es de 200 milisegundos. Siendo que una sección se transporta en, al menos, un paquete, y el número de paquetes en un intervalo de tiempo es necesariamente finito, el número de servicios también lo es en consecuencia. 

Para este análisis se continúa con el ejemplo del Canal 23, presentado en el capítulo Introducción Técnica. De los $17.3 Mbps$ disponibles del flujo de tranporte, unos $2.4 Mbps$ son ocupados por paquetes nulos, los cuales pueden ser reemplazados por una PMT de un servicio realocado. Esta cifra representa unos 1500 paquetes nulos por segundo. La norma ISDB-Tb determina que las instancias de la PMT deben encontrarse en un período regular de $200 ms$, un quinto de segundo. Así, la cantidad de paquetes disponibles para insertar PMT's se aproxima a los 300.

Esta estimación indica que el número máximo de servicios, si de la PMT depende, tiene una cota superior en 300. Pero existe un problema adicional con la estimación y es que no hay motivos para creer que este número no disminuirá en alguna porción del flujo de transporte. Además, la cota superior real es el mínimo local absoluto de número de paquetes nulos en períodos de $200ms$ en todo el flujo de transporte. Siendo que este es arbitrariamente largo, es imposible determinar este número. 

\begin{figure}[h]
	\begin{center}
	\includegraphics[width=14cm]{imgs/nulos_disponibles.png}
	\caption{Gráfico lineal de disponibilidad de paquetes nulos en el flujo de transporte\label{fig:null_available}} 
	\end{center}
\end{figure}

La \cref{fig:null_available} presenta los resultados de una medición sobre un fragmento real de flujo de transporte de Canal 23. Muestra el conteo de paquetes nulos disponibles en los siguientes $200 ms$ de reproducción para cada instante de un fragmento de flujo de transporte de dos minutos y medio de duración. Se puede apreciar que el mínimo alcanzado es de 271 paquetes para un instante que ronda el segundo 86. Esto quiere decir que el número máximo de PMT's que se puede incluir dada esta sección del flujo de transporte supera las 200 instancias. 

Como la figura \cref{fig:max_serv_num} muestra, es indistinto el hecho de que la tabla ocupe un único paquete o una sección completa, dado que no es el tamaño la limitación de la tabla, sino el número de repeticiones posibles en el intervalo de tiempo establecido por el estándar ISDB-Tb. En conclusión, una estimación conservadora del número máximo de servicios que se pueden incluir en un flujo de transporte con características similares al de Canal 23 es de 200 servicios.

\subsection{Infraestructura requerida}

Las redes IP se basan en el intercambio de paquetes entre nodos. Los enlaces que unen estos nodos están limitados en ancho de banda por el soporte físico sobre el que envían los paquetes. Cuando se sobrecargan estos enlaces pueden ocurrir bloqueos en los servicios.

Volviendo a la \cref{fig:infra_extended}, el enlace entre el servidor de \emph{streaming} resulta un eslabón clave en el esquema. Encontrar un cuello de botella en la red requiere de una topología, pero es común que los \emph{hosts} posean un único \emph{access point} (y, por ende, un único enlace) a la red. Con esto, el ancho de banda limita el número y la calidad de los servicios que puede emitir un único servidor de \emph{streaming}.

\begin{figure}[h]
	\begin{center}
	\includegraphics[width=14cm]{imgs/infra_multiple_streamers.png}
	\caption{Infraestructura con múltiples servidores de \emph{streaming}\label{fig:infra_multiple_streamers}} 
	\end{center}
\end{figure}

La \cref{fig:infra_multiple_streamers} ilustra el caso en que los servicios se distribuyen a través de múltiples servidores de \emph{streamings}. En este caso, el cuello de botella podría hallarse en alguno de los enlaces \emph{backbone}\footnote{Término utilizado para las principales enlcaes de datos en una red. En este caso, en particular, refiere a una red IP.} si el enlace fuera una arista de corte. Sin embargo, este tipo de enlaces suele disponer del mayor ancho de banda en toda la red.

[Un enlace de fibra óptica alcanza velocidades de transmisión que oscila desde los tata hasta los zarasa. quizá, no se. ]

\section{Aspectos adicionales}

Esta sección compara los servicios regulares ISDB-Tb con los servicios realocados a través del \emph{service\_elementaries\_relocation\_descriptor} en distintos términos de la televisión digital. La  \cref{tab:evalcomparison} categoriza los distintos aspectos de la comparación, que se desarrollan en las subsecciones siguientes.

\renewcommand{\thefootnote}{\fnsymbol{footnote}}
\taburowcolors[2]{white .. black!20}

\begin{figure}[h]
\footnotesize
\tabulinesep=6pt
\begin{tabu}{|>{\cellcolor{black!60}\color{white}}r|X[cm]|X[cm]|}
\hline
\rowcolor{black!80}\strut  & \color{white}Servicios Regulares & \color{white}Servicios Realocados \\
Múltiples flujos elementales & \cmark & \xmark* \\
Guía electrónica de programación & \cmark & \cmark \\
\emph{Closed Caption} & \cmark & \xmark* \\
Trazabilidad & \xmark & \cmark \\
DSM-CC & \cmark & \xmark \\
Independencia de calidad de servicio & \xmark & \cmark \\
Sintonización múltiple simultánea & \xmark & \cmark \\
Velocidad de sintonización & ~$1.8$ seg & Depende de la red \\
\hline
\end{tabu}
\caption{Comparación entre los servicios de una señal ISDB-Tb y los servicios realocados. \textbf{(*)} Limitación impuesta por el cliente, Mara. Implementaciones más sofisticadas podrían dar soporte.\label{tab:evalcomparison}} 

% Reemplazar esto por un footnote que explique que esos dos (... como puede verse en la subsección tal ...) son limitaciones de implementacion del cliente, no del estándar. Así no hay que usar el plusmark del orto, que de otra manera, habría uqe explicar.

\end{figure}
\renewcommand{\thefootnote}{\arabic{footnote}}

\subsection{Flujos elementales múltiples}

Es normal que en los servicios de televisión digital se incluyan varios flujos elementales de un mismo tipo para un mismo servicio. Por ejemplo, la emisión de un partido de fútbol podría incluir múltiples audios para permitir la elección del relato a reproducir, posiblemente en distintos idiomas. Esto no suele ocurrir para el video.

En el caso de ISDB-Tb extendido, la red IP emite un flujo de transporte simple. Esto es un flujo que contiene un único servicio sin la inclusión de múltiples flujos elementales. Esto puede considerarse una limitación del diseño pero resulta importante, para los servicios que viajan por IP, la eliminación de toda información redundante. Si se emitieran múltiples flujos de audio a través el mismo flujo, entonces algunos de ellos serían ignorados, incurriendo en un desperdicio innecesario de ancho de banda. En otras palabras, todos los audios, menos aquel que se está reproduciendo, serían inútiles.

\subsection{Guía electrónica de programación}

La guía electrónica de programación (o EPG por sus siglas en inglés) contiene información acerca de los eventos en los servicios del flujo de transporte. La información que compone a la guía de programación se construye por las emisoras de contenido y se envía a los decodificadores a través de la EIT(\emph{Event Information Table}). Las secciones que componen una EIT pueden alcanzar los 4096 bytes. Cabe remarcar que cada sección guarda un bloque de tres horas de eventos.

Se suele denotar EIT-k a cada sección, donde un k mayor denota un bloque más lejano en el tiempo. Así, EIT-0 describe los eventos de las próximas tres horas y EIT-1 los eventos de las tres horas siguientes. En consecuencia hay 4096 bytes para describir los eventos que ocurren en todos los servicios en el intervalo de tiempo que le corresponde a la sección.

El tamaño de cada descripción de evento depende del título del mismo y del texto asociado. Por esto, es imposible determinar cuántos servicios se pueden describir, pero se puede realizar una estimación sobre el espacio disponible para cada evento, dada una lista de servicios.

Asumiendo que la lista de servicios del flujo de transporte posee 50 entradas (limitación impuesta por la sección de la SDT), y que en tres horas cada servicio aparecen dos eventos, se deben describir 100 eventos. 

\begin{figure}[h]
	\begin{center}
	\includegraphics[width=12cm]{imgs/eit_section_syntax.png}
	\caption{Representación ilustrativa de la sintaxis de una sección de EIT\label{fig:eit_section_syntax}} 
	\end{center}
\end{figure}

La \cref{fig:eit_section_syntax} ilustra el formato de una sección de la EIT. El encabezado de la EIT ocupa los primeros 14 bytes, y cada evento, a su vez, tiene un tamaño base de 12 bytes. Esto significa que de los 4096 bytes disponibles de la sección, 2882 pueden utilizarse para títulos y descripción de eventos. Lo cual da un promedio de $29$ bytes por evento para título y descripción.

\begin{figure}[h]
	\begin{center}
	\includegraphics[width=14cm]{imgs/eit_size.png}
	\caption{Gráfico de puntos que describe la disponibilidad de caracteres para la descripción de eventos en la EIT\label{fig:eit_size}} 
	\end{center}
\end{figure}

La \cref{fig:eit_size} establece una relación entre el número de eventos a describir y la cantidad de caracteres disponibles. A partir de los 20 eventos, la disponibilidad cae debajo de los 200. En conclusión, no es posible describir acordemente todos los servicios incluidos en el flujo de transporte extendido a través de la EIT, salvando la inclusión del nombre del evento y la información textual asociada a alguno de ellos.

\subsection{\emph{Closed Captioning}}

Existen varios estándares ampliamente difundidos para la transmisión de \emph{Closed Caption}. El formato estándar para ISDB-Tb se define en ARIB-B37. Otro tipo también muy difundido, pero más popular en otras normas como ATSC, es CEA 608 y su sucesor CEA 708\cite{ceaclosedcaption}, denominados comúnmente simplemente por el número. Existe una diferencia principal entre ambos formatos que propone una clasificación de los estándares de subtitulado.

\begin{itemize}
	\item \textbf{Embebidos}: En esta categoría se encuentran los formatos 608 y 708. Los subtítulos de esta categoría se incluyen en un espacio preasignado de un flujo externo. Por ejemplo, el formato de video H.264 provee un espacio de usuario para incluir, entre otras cosas, subtítulos. La característica que define a esta categoría es que no necesitan señalización en la PMT, dado que los \emph{Closed Caption} forman parte del flujo elemental de video.
	\item \textbf{Señalizados}: Categorizamos en este grupo a los canales de \emph{Closed Caption} que deben ser referidos por la \pmt\ y que viajan en un flujo elemental con su propio PID. En esta categoría entra el formato ARIB-37.
\end{itemize}

Mara no posee la funcionalidad de reproducir ninguno de los dos tipos. La imposibilidad de reproducir subtítulos señalizados viene dada por el diseño de la señalización. Por otro lado, la imposibilidad de reproducir los subtítulos embebidos se debe a la forma que Wari reproduce los flujos elementales. 

Reproducir el \emph{Closed Caption} de la primer categoría requeriría de Mara leer la PMT del servicio realocado para demultiplexar los paquetes que transportan los datos de subtitulado. Para esto, \emph{mpegparser} debería filtrar los paquetes involucrados y realizar el \emph{parsing}.

Los subtítulos de la segunda categoría pueden ser manejados directamente por el reproductor, dado que forman parte del video. El cambio necesario implica enviar un mensaje al reproductor para active la pista de subtítulos correspondiente. La complejidad de la modificación depende el estándar de \emph{Closed Caption}, pero no implica la lectura del flujo de transporte en \emph{mpegparser}.

\subsection{Trazabilidad}

El esquema de emisión en las señales ISDB-Tb es \emph{broadcast}. En este esquema los consumidores son anónimos, lo cual implica que es imposible establecer si un receptor está consumiendo un servicio dado. En el caso de los servicios realocados, las redes IP identifican a los \emph{hosts} unívocamente a través de una dirección IP. Para saber si un receptor consume un servicio tranportado por IP, éste puede ser asociado a una dirección y determinar a qué grupo multicast está unido. 
[TODO: Acá hay que decir algo más o sacarlo. Se puede decir algo sobre medición de rating, por ejemplo. Pero creo que está medio tirado de los pelos. Si bien creo que es interesante para comparar, no se si merece una subsección entera.]

\subsection{DSM-CC}

\subsection{Independencia de calidad del servicio}

\subsection{Averiguar qué onda con el scrambling y el acceso condicional} 

% Se podría stremear el certificado PKI por ISDB-Tb, por ejemplo.
% Un transport stream que refiere a dos servicios diferidos.
% Dos transport streams que refieren a dos servicios diferentes. Uno cada uno.
% Un transport stream que refiere a muchos servicios. Digamos 10.
% Un transport stream que refiere a 2 servicios. Uno de los cuales no tiene emisión.
% Closed caption
% Cómo se comportaría el acceso condicional con el esquema extendido
% Problemas de seguridad? Si alguien se pone a emitir algo en algún momento
% Todo el resto de las cosas deberían funcionar. Ver el tema del bitrate puede ser más complicado.
% Con este esquema es imposible usar varios audios.
% También es imposible mandar video por multicast y audio por ts.
% Todos los flujos elementales se deben enviar por el mismo medio.
% Está bueno que no le interesa al ts si el servicio es HD o SD. Inclusive podría cambiar, supongo yo.

\subsection{Tiempo de sintonización}

[Se puede hacer referencia al diagrama de secuencia del capítulo anterior para explicar la demora.]


\ifx\all\undefined
\end{document}
\fi