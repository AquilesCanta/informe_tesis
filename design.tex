\ifx\all\undefined
\include{base}
\begin{document}
\fi
 
\chapter{Diseño y desarrollo}

Al momento de escritura de este informe, la Ciudad autónoma de Buenos Aires presenta la mayor cantidad de servicios ofrecidos en el país por la televisión digital abierta: 16 servicios ofrecidos a nivel nacional, más 10 servicios emitidos en AMBA y CABA y 2 adicionales en provincia de Buenos Aires, sumando un total de 28 servicios. En una red de transmisión de televisión analógica por cable, el número de servicios asciende a 70. Aún teniendo en mente que el formato antiguo de transmisión utilizado.

El problema de ISDB-T radica en la escacés de canales físicos para la transmsión de servicios. Para este problema no hay una solución previsible a futuro mediato. 

La masividad del consumo televisivo, por otro lado, dificulta la utilización de mecanismos que no utilicen broadcasting. Es necesaria una infraestructura extremadamete robusta para soportar la alimentación de algunos millones de sistemas de recepción[AGREGAR UNA CITA A INTRODUCCION CON EJEMPLOS DE LOS PENALES CON HOLANDA?]. Por ejemplo, la transmisión de IPTV, en estos casos, es riesgosa y la caída del servicio tiene repercusiones graves.

El problema de IPTV radica en que la infraestructura es compleja y delicada. Es, además, suceptible a la sobreexigencia.

En el caso de la televisión analógica terrestre, este problema es insondable. Con la introducción de la televisión digital y la combinación con IPTV, ambos esquemas de transmisión puede complementarse para obtener un mejor sistema.   

\section{Señalización y distribución de servicios}

El primer paso para combinar los sistemas de transmisión es definir qué servicios viajan por qué medio e indicar esto a los dispositivos de recepción. En cualquier sistema de entrega de contenidos, es necesario que la lista de señales llegue a todos los consumidores.

El mecanismo de entrega de esta lista también es un punto de desarrollo del sistema. 

\section{Estructura general del sistema combinado}
La entrega de contenidos televisivos posee agentes de emisión y recepción. En el caso de un sistema que integre transparentemente IPTV e ISDB-T, naturalmente posee dos agentes de emisión. La emisión, a su vez, está asociada a un formato de transmisión. El sistema entonces, posee tres puntos de estudio:

\begin{itemize}
\item Entrega de servicios por ISDB-Tb, formato \textbf{MPEG-TS} extendido.
\item Entrega de servicios por redes IP (o IPTV) con esquema \emph{multicast}.
\item Recepción y combinación de ambas. Desarrollo de \textbf{Mara}.
\end{itemize}


\section{Extensión del formato \textbf{MPEG-TS}}

En algún punto del proceso de identificación de servicios del receptor se deben introducir los medios necesarios para acceder a los servicios a los que se accede por Internet. 

El primer paso es dar soporte al formato para los servicios cuyos flujos elementales no se transmiten por el mismo \emph{ts}. En este trabajo, los paquetes \pes\ asociados son transportados por una red IP. A fin de que un receptor pueda consumir estos paquetes necesitan invariablemente de una dirección IP y un número de puerto. De esa manera, cuando el usuario sintoniza un servicio cuyos \emph{elementary streams} se transmiten por IP, el receptor puede unirse al grupo \emph{multicast} por el que se emiten y así consumirlos.

\subsection{Recipiente de datos}

Para enviar los datos necesarios se define un nuevo descriptor denominado \emph{elementaries relocation descriptor} con \emph{descriptor tag} 0xAA. En un receptor, encontrar este descriptor en la \pmt\ de un servicio implica que los flujos elementales a reproducir para tal servicio se emiten de manera \emph{multicast} en el grupo y puerto identificados por los datos contenidos en el descriptor.

Sólamente una vez el usuario haya solicitado un servicio con el descriptor 0xAA el receptor intentará unirse al grupo \emph{multicast} asociado. De esta manera, la utilización de recursos de red se limita a lo estrictamente necesario.

\subsection{Construcción de \emph{transport streams}}

En la construcción de un flujo de transporte de referencia se utilizó el proyecto OpenCaster. Dado que el mismo no da soporte nativo a estructuras ajenas al formato \textbf{MPEG-TS}, se agregó a la API de construcción una clase correspondiente al \emph{elementaries relocation descriptor}. Esto implica que un \emph{transport stream} con servicios por IPTV pueden ser generados con OpenCaster.

El proceso de extender un \emph{ts} ya válido para agregarle servicios cuyos flujos elementales vienen por \emph{multicast} es el siguiente:
\begin{enumerate}
\item Agregar una entrada a la \pat\ correspondiente al servicio nuevo. Se puede hacer a través de la utilización de OpenCaster.
\item Agregar el servicio en la \sdt, adjuntándole tipo y nombre. Se puede hacer a través de OpenCaster.
\item Agregarle una \pmt\ correspondiente al servicio agregado al flujo y multiplexarlo respetando la limitación de aparecer cada 200 milisegundos. Esta \pmt\ debe incluir un \emph{elementaries relocation descriptor} con la dirección IP y puerto que identifican a los flujos elementales del servicio.

[TODO: Darle identidad a la suite de herramientas creada para la tesis y desde acá sólo referir a tal suite como si fuera OpenCaster] Para realizar este paso se creó una herramienta de inserción de paquetes dentro del proyecto ``ts\_util''.

\end{enumerate}

La emisión de un \emph{transport stream} extendido no difiere de la de uno regular.

\section{Entrega de servicios por redes IP}

De acuerdo a la definición presentada anteriormente, la televisión digital clasifica como televisión en vivo. La implementación ideal (en términos de aprovechamento eficiente de recursos) implica utilizar emisión \emph{multicast}. De esa manera el uso de ancho de banda y \emph{buffering} se mantiene igual al de enviar un flujo multimedia a un único cliente.

Sin embargo, el envío \emph{multicast} exige la utilización de datagramas en lugar de un sistema con entrega garantizada como TCP. Esto quiere decir que el formato contenedor de los contenidos debe ser tolerante a fallos y errores. Cabe notar que el \textbf{MPEG-TS} está diseñado para este tipo de ambientes.

Entonces, para el envío de contenido multimedia por IP se utiliza un \emph{transport stream} mínimo. Llamamos así a aquel \emph{ts} que contiene un único servicio sin paquetes nulos.

\section{Recepción}

Las tareas de un dispositivo receptor de \emph{transport stream} se resumen en lo siguiente:

\begin{itemize}
\item Construir la lista de servicios disponibles.
\item Asociar cada servicio a un conjunto de flujos elementales.
\item Entregar los paquetes PES asociados al servicio sintonizado al reproductor.
\end{itemize}

El caso de un \emph{transport stream} extendido no es diferente. Sin embargo, la entrega de los paquetes PES sí lo es. A continuación se detallan los cambios requeridos.

\subsection{Modificaciones en \textbf{mpeg-parser}}

Las modificaciones en la librería se pueden comprender en tres partes. En primer instancia, el sistema debe ser capaz de capturar el descriptor, identificarlo y obtener sus contenidos. En segundo lugar, de acuerdo a estos contenidos, se debe modificar el modelo/estdo del sistema y, finalmente, éste debe poder reaccionar acordemente a las modificaciones. Es decir, cuando así se requiera, la reproducción debe obtener sus fuentes del medio correcto.

\subsection{Obtención y \emph{parsing} del descriptor}

Se agregó el modelo del descriptor, el descriptor tag y la función de parsing. También ahora el servicio invoca process descriptors.

\subsection{Modificación del modelo}

Se metió un booleano en la clase descriptor, junto a un string que modela el grupo multicast y un short para el puerto. Una crotada básicamente.

\subsection{Reproducción de servicio}

Si se encuentra que es un servicio relocado, entonces en la URL se manda una dirección IP en vez del URL inventado.




\section{Lista de servicios extendida}

El primer paso es construir un \emph{transport stream} que contenga servicios que vienen por otro medio, una red IP. Para ello el \emph{ts} debe proveer un mecanismo de acceso para los contenidos. En el caso de TCP o UDP, la identificación es la misma: Una dirección IP y un puerto asociado, independientemente del esquema utilizado, \emph{unicast} o \emph{multicast}.

Como recipiente de estos datos, agregamos un descriptor privado denominado \emph{elementaries relocation descriptor}, con \emph{descriptor tag} 0xAA.

Se debe agregar una entrada a la PAT

Se debe agregar un descriptor a la SDT (OJO! Puede implicar la necesidad de dividir la sección en dos paquetes!)

Se debe crear una nueva PMT e insertarla en el TS válido de partida.

* Hay que enviar por UDP sí o sí.


















\section{Relocación de los \emph{elementary streams} de los servicios agregados}

\section{Emisión de los flujos elementales por IP}

El envío de \emph{elementary streams} por IP \emph{multicast} permite evitar la repetición de paquetes iguales enviados de forma simultánea a múltiples receptores. Èste esquema requiere el uso de datagramas. Como este protocolo es suceptible a pérdidas, el formato enviado debe poder recuperarse ante tales problemas. El \textbf{MPEG-TS} es ideal para este tipo de envíos. 

\ifx\all\undefined
\end{document}
\fi